{% extends "_layouts/cp" %}
{% import '_includes/forms' as forms %}

{% do view.registerAssetBundle('nystudio107\\seomatic\\assetbundles\\seomatic\\SeomaticAsset') %}
{% set baseAssetUrl = view.getAssetManager().getPublishedUrl('@nystudio107/seomatic/assetbundles/seomatic/dist', true) %}

{% set metaBundles = craft.seomatic.getContentMetaBundles(false) %}

{% set title = craft.seomatic.getPluginName() ~ " Content SEO" %}

{% set fullPageForm = true %}

{% set docsUrl = "https://github.com/nystudio107/craft3-seomatic/wiki" %}

{% set seomaticSections = {
    content: { label: "Content SEO"|t, url: url('seomatic/content') },
    global: { label: "Global SEO"|t, url: url('seomatic/global') },
} %}

{% set crumbs = [
    { label: craft.seomatic.getPluginName(), url: url('seomatic') },
    { label: "Content SEO"|t, url: url('seomatic/content') },
] %}

    {% set subnav = seomaticSections %}
    {% set selectedSubnavItem = 'content' %}

{% set content %}

    <input type="hidden" name="action" value="seomatic/saveContentSeo" />
    <input type="hidden" name="redirect" value="seomatic/content" />

    {{ getCsrfInput() }}

    <table class="data">
        <thead class="sections first">
        {#
        <tr>
            <th colspan="6">
                <h1>{{ "Content"|t }}</h1>
            </th>
        </tr>
        #}
        <tr>
            <th>{{ "Name"|t }}</th>
            <th class="thin">{{ "Entries"|t }}</th>
            <th>{{ "Type"|t }}</th>
            <th>{{ "Custom SEO"|t }}</th>
            <th>{{ "Setup"|t }}</th>
            <th class="thin"></th>
            <th class="thin"></th>
        </tr>
        </thead>

        <tbody class="sections">
        {% for metaBundle in metaBundles %}
            {% set num_entries = 0 %}
            <tr>
                <td>
                    {% set sourcePrefix =  '' %}
                    {% switch metaBundle.sourceType %}
                        {% case 'channel' %}
                            {% set sourcePrefix = 'settings/sections/' %}
                        {% case 'structure' %}
                            {% set sourcePrefix = 'settings/sections/' %}
                        {% case 'single' %}
                            {% set sourcePrefix = 'settings/sections/' %}
                        {% case 'category' %}
                            {% set sourcePrefix =  'settings/categories/' %}
                    {% endswitch %}
                    <a href="{{ url(sourcePrefix ~ metaBundle.sourceId) }}">{{ metaBundle.sourceName }}</a>
                </td>
                <td>
                    {% set numEntries = craft.entries.total({ sectionId: metaBundle.sourceId }) %}
                    {{ numEntries }}
                </td>
                <td>
                    {{ metaBundle.sourceType }}
                </td>
                <td>
                    {# -- Meta Tags -- #}
                    {% set total = 0 %}
                    {% for metaTagContainer in metaBundle.metaTagContainer %}
                        {% set total = total + (metaTagContainer.data |length) %}
                    {% endfor %}
                    <div title="{{ total }} Meta Tags" class="content-icon-wrapper">
                        <object type="image/svg+xml"
                                data="{{ baseAssetUrl ~ '/img/tags-icon.svg' }}"
                                class="content-icon {% if total > 0 %}content-seo-enabled{% else %}content-seo-disabled{% endif %}">
                        </object>
                    </div>
                    {# -- Meta Links -- #}
                    {% set total = 0 %}
                    {% for metaLinkContainer in metaBundle.metaLinkContainer %}
                        {% set total = total + (metaLinkContainer.data |length) %}
                    {% endfor %}
                    <div title="{{ total }} Link Tags" class="content-icon-wrapper">
                        <object type="image/svg+xml"
                                data="{{ baseAssetUrl ~ '/img/link-icon.svg' }}"
                                class="content-icon {% if total > 0 %}content-seo-enabled{% else %}content-seo-disabled{% endif %}">
                        </object>
                    </div>
                    {# -- Meta Scripts -- #}
                    {% set total = 0 %}
                    {% for metaScriptContainer in metaBundle.metaScriptContainer %}
                        {% set total = total + (metaScriptContainer.data |length) %}
                    {% endfor %}
                    <div title="{{ total }} Script Tags" class="content-icon-wrapper">
                        <object type="image/svg+xml"
                                data="{{ baseAssetUrl ~ '/img/script-icon.svg' }}"
                                class="content-icon {% if total > 0 %}content-seo-enabled{% else %}content-seo-disabled{% endif %}">
                        </object>
                    </div>
                    {# -- Meta Json Ld -- #}
                    {% set total = 0 %}
                    {% for metaJsonLdContainer in metaBundle.metaJsonLdContainer %}
                        {% set total = total + (metaJsonLdContainer.data |length) %}
                    {% endfor %}
                    <div title="{{ total }} Structured Data Objects" class="content-icon-wrapper">
                        <object type="image/svg+xml"
                                data="{{ baseAssetUrl ~ '/img/structured-data-icon.svg' }}"
                                class="content-icon {% if total > 0 %}content-seo-enabled{% else %}content-seo-disabled{% endif %}">
                        </object>
                    </div>
                    {# -- Sitemap -- #}
                    <div title="{% if metaBundle.sitemapUrls %}Sitemap Enabled{% else %}Sitemap Disabled{% endif %}" class="content-icon-wrapper">
                        <object type="image/svg+xml"
                                data="{{ baseAssetUrl ~ '/img/sitemap-icon.svg' }}"
                                class="content-icon {% if metaBundle.sitemapUrls %}content-seo-enabled{% else %}content-seo-disabled{% endif %}">
                        </object>
                    </div>
                </td>
                <td>
                    <span class="content-seo-checkmark">&check;</span>
                </td>
                <td>
                    <a class="btn">Settingsâ€¦</a>
                </td>
                <td>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

{% endset %}
